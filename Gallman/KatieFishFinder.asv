function out = KatieFishFinder(in)
%% usage
%takes raw fft amp data from each tube and assigns it to high and low freq fish
%kg2(#).fish = KatieFishFinder(kg2(#).s)

%kg2(#).s = KatieSeparationAnxiety('Eigen*');

%% assign amplitude data to fish by frequency
%figure(987); clf; hold on;
    %Indicies when each fish was in each tube
    %threshold for ratio at 2.5
        %when each fish was in tube 2
        intube2hi = find([in.e2hiamp] ./ [in.e1hiamp] > 2.5);
            %plot([out(intube2hi).timcont], [out(intube2hi).e2hiamp], 'b.');
        intube2lo = find([in.e2loamp] ./ [in.e1loamp] > 2.5);
            %plot([out(intube2lo).timcont], [out(intube2lo).e2loamp], 'm.');

        %when each fish was in tube 1
        intube1hi = find([in.e1hiamp] ./ [in.e2hiamp] > 2.5);
             %plot([out(intube1hi).timcont], [out(intube1hi).e1hiamp], 'bo');
        intube1lo = find([in.e1loamp] ./ [in.e2loamp] > 2.5);
            %plot([out(intube1lo).timcont], [out(intube1lo).e1loamp], 'mo');
      

    %test alternative eric
        %hi frequency fish
        %out.HiAmp = zeros(1, length(intube2hi));
            %tube 2
            for j=1:length(intube2hi)
                out.his(intube2hi(j)).HiAmp1 = in(intube2hi(j)).e2hiamp;
                out.his(intube2hi(j)).HiTim1 = in(intube2hi(j)).timcont/3600;
                out.his(intube2hi(j)).HIfreq1 = [in(intube2hi(j)).hifreq];
            end
            %tube 1
            for j=1:length(intube1hi)
                out.his(intube1hi(j)).HiAmp1 = in(intube1hi(j)).e1hiamp;
                out.his(intube1hi(j)).HiTim1 = in(intube1hi(j)).timcont/3600;
                out.his(intube1hi(j)).HIfreq1 = [in(intube1hi(j)).hifreq];
            end

            
        %low frequency fish
       % out.LoAmp = zeros(1, length(intube2lo));
            %tube 2    
            for j=1:length(intube2lo)
                out.los(intube2lo(j)).LoAmp1 = in(intube2lo(j)).e2loamp;
                out.los(intube2lo(j)).LoTim1 = in(intube2lo(j)).timcont/3600;
                out.los(intube2lo(j)).LOfreq1 = [in(intube2lo(j)).lofreq];
            end
            %tube 1
            for j=1:length(intube1lo)
                out.los(intube1lo(j)).LoAmp1 = in(intube1lo(j)).e1loamp;
                out.los(intube1lo(j)).LoTim1 = in(intube1lo(j)).timcont/3600;
                out.los(intube1lo(j)).LOfreq1 = [in(intube1lo(j)).lofreq];
            end 
            

%% filter by fish frequency
figure(1); clf;

    histogram([out.his.HIfreq1], 100); hold on;
    
    %Lower lim
    fprintf('Click cutoff for eliminating erroneously low amplitude measurements.\n');
    [cutofffreqL, ~]  = ginput(1);
    plot([cutofffreqL, cutofffreqL], [0 10], 'r-', 'LineWidth', 2, 'MarkerSize', 12);
    drawnow; 
    
    %Upper lim
    fprintf('Click cutoff for eliminating erroneously high amplitude measurements.\n');
    [cutofffreqH, ~]  = ginput(1);
    plot([cutofffreqH, cutofffreqH], [0 10], 'r-', 'LineWidth', 2, 'MarkerSize', 12);
    drawnow; 
    
    for j=1:length(in.his)
         if out.his(j).HIfreq1 > cutofffreqL & out.his(j).HIfreq1 < cutofffreqH
                out.his(j).HiAmp = out.his(j).HiAmp1;
                out.his(j).HiTim = out.his(j).HiTim1;
                out.his(j).HIfreq = out.his(j).HIfreq1;
         end
    end

    pause(1);
    
    
figure(1); clf;

    histogram([in.los.LOfreq1], 100); hold on;
    
    %Lower lim
    fprintf('Click cutoff for eliminating erroneously low amplitude measurements.\n');
    [cutofffreqL, ~]  = ginput(1);
    plot([cutofffreqL, cutofffreqL], [0 10], 'r-', 'LineWidth', 2, 'MarkerSize', 12);
    drawnow; 
    
    %Upper lim
    fprintf('Click cutoff for eliminating erroneously high amplitude measurements.\n');
    [cutofffreqH, ~]  = ginput(1);
    plot([cutofffreqH, cutofffreqH], [0 10], 'r-', 'LineWidth', 2, 'MarkerSize', 12);
    drawnow; 
    for j=1:length(in.los)
         if in.los(j).LOfreq1 > cutofffreqL & in.los(j).LOfreq1 < cutofffreqH
             out.los(j).LoAmp = out.los(j).LoAmp1;
             out.los(j).LoTim = out.los(j).LoTim1;
             out.los(j).LOfreq = out.los(j).LOfreq1;
         end
    end
    pause(1);
end
            
%% Plot fish against light/temp
figure(1); clf; 

    
    assx(1) = subplot(411); hold on; 
        plot([out.his.HiTim], [out.his.HiAmp], '.');
        plot([out.los.LoTim], [out.los.LoAmp], '.');

        legend('High frequency fish', 'Low frequency fish');
        
    assx(2) = subplot(412); hold on;
        plot([out.his.HiTim], [out.his.HIfreq], '.'); 
        plot([out.los.LoTim], [out.los.LOfreq], '.');
        
    
    assx(3) = subplot(413); hold on; 
            plot([in.timcont]/(60*60), [in.temp], '.');
    
    assx(4) = subplot(414); hold on;
        plot([in.timcont]/(60*60), [in.light]);
        ylim([-1, 6]);
        
linkaxes(assx, 'x');